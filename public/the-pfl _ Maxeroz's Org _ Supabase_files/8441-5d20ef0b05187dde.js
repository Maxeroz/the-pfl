"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8441],{99009:function(e,l,s){s.d(l,{Z:function(){return ec}});var t=s(52322),a=s(24990),r=s(59491),n=s(99959),o=s(18149),i=s.n(o),d=s(79394),c=s(2784),u=s(47370),x=s(62202),m=s(10621),h=s(87175),v=s(82955),j=s(74067),g=s(54383),f=s(34503),p=s(32079),w=s(43687),b=s(23418),y=s(54506),N=s(26815),_=s(57394),S=s(48869),C=s(79983),k=s(71023);let E=e=>(0,t.jsxs)(k.VK,{children:[(0,t.jsx)(k.io,{value:e.row.timestamp}),(0,t.jsx)(k.VG,{className:"w-full",value:e.row.event_message})]});var Z=[{name:"default-preview-first-column",key:"default-preview-first-column",renderCell:E}];let L=[{name:"auth-first-column",key:"auth-first-column",renderCell:e=>{var l;return e.row.level?(0,t.jsxs)(k.VK,{children:[(0,t.jsx)(k.io,{value:e.row.timestamp}),e.row.level&&(0,t.jsx)(k.TK,{value:e.row.level}),(0,t.jsx)(k.VG,{className:"w-full",value:"".concat(e.row.path?e.row.path+" | ":"").concat((null===(l=e.row.msg)||void 0===l?void 0:l.trim())||e.row.event_message)})]}):E(e)}}],R=[{name:"database-api-first-column",key:"database-api-first-column",renderCell:e=>e.row.status_code||e.row.method||e.row.path?(0,t.jsxs)(k.VK,{children:[(0,t.jsx)(k.io,{value:e.row.timestamp}),(0,t.jsx)(k.XA,{row:e,value:e.row.status_code}),(0,t.jsx)(k.VG,{className:"w-20",value:e.row.method}),(0,t.jsx)(k.VG,{className:"w-full",value:e.row.path})]}):E(e)}],T=[{name:"database-postgres-first-column",key:"database-postgres-first-column",renderCell:e=>e.row.error_severity?(0,t.jsxs)(k.VK,{children:[(0,t.jsx)(k.io,{value:e.row.timestamp}),(0,t.jsx)(k.TK,{value:e.row.error_severity}),(0,t.jsx)(k.VG,{className:"w-full",value:e.row.event_message})]}):E(e)}],W=[{name:"functions-edge-first-column",key:"functions-edge-first-column",renderCell:e=>e.row.status_code||e.row.method?(0,t.jsxs)(k.VK,{children:[(0,t.jsx)(k.io,{value:e.row.timestamp}),(0,t.jsx)(k.XA,{row:e,value:e.row.status_code}),(0,t.jsx)(k.VG,{value:e.row.method}),(0,t.jsx)(k.VG,{value:e.row.id})]}):E(e)}],O=[{name:"functions-logs-first-column",key:"functions-logs-first-column",renderCell:e=>e.row.event_type||e.row.level?(0,t.jsxs)(k.VK,{children:[(0,t.jsx)(k.io,{value:e.row.timestamp}),"uncaughtException"===e.row.event_type?(0,t.jsx)(k.TK,{value:e.row.event_type,uppercase:!1}):(0,t.jsx)(k.TK,{value:e.row.level}),(0,t.jsx)(k.VG,{className:"w-full",value:e.row.event_message})]}):E(e)}];var F=s(60795),M=s(8609),Y=s(25733),z=s(62112),I=s(36492),V=s(62197),q=s(16698),D=s(88354),A=s(99248),J=function(e,l,s,t){let a=l?V.ae[l]:void 0,r=t&&a?(0,q.ue)(a,t):"",n={...s,project:e,sql:r},o="".concat(A.T5,"/projects/").concat(e,"/analytics/endpoints/logs.all?").concat((0,V.GT)(n)),i=!!(t&&a&&"warehouse"!==l),{data:d,error:c,isLoading:u,isRefetching:x,refetch:m}=(0,I.a)(["projects",e,"log",t],e=>{let{signal:l}=e;return(0,D.U2)(o,{signal:l})},{enabled:i,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1}),h=c?c.message:null;return{logData:(null==d?void 0:d.result)?d.result[0]:void 0,isLoading:i&&u||x,error:h,refresh:()=>m()}},K=s(89828),H=s(58898),P=e=>{var l,s,a,r,n,o,i,d,c,u,x;let{log:m}=e;return(0,t.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding," space-y-6"),children:[(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsx)("h3",{className:"text-foreground-lighter text-sm",children:"Event Message"}),(0,t.jsx)("div",{className:"text-xs text-wrap font-mono text-foreground whitespace-pre-wrap overflow-x-auto",children:(null===(l=m.metadata)||void 0===l?void 0:l.msg)||m.event_message})]}),(0,t.jsx)(k.tS,{value:m.timestamp}),(null===(s=m.metadata)||void 0===s?void 0:s.status)&&(0,t.jsx)(k.Yj,{label:"Status",value:String(null===(a=m.metadata)||void 0===a?void 0:a.status),valueRender:(0,t.jsx)(k.XA,{value:null===(r=m.metadata)||void 0===r?void 0:r.status})}),(null===(n=m.metadata)||void 0===n?void 0:n.level)&&(0,t.jsx)(k.Yj,{label:"Severity",value:null===(o=m.metadata)||void 0===o?void 0:o.level,valueRender:(0,t.jsx)(k.TK,{value:null===(i=m.metadata)||void 0===i?void 0:i.level})}),(null===(d=m.metadata)||void 0===d?void 0:d.path)&&(0,t.jsx)(k.Yj,{label:"Request Path",value:null===(c=m.metadata)||void 0===c?void 0:c.path}),(null===(u=m.metadata)||void 0===u?void 0:u.error)&&(0,t.jsx)(k.Yj,{label:"Error Message",value:null===(x=m.metadata)||void 0===x?void 0:x.error}),(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsx)("h3",{className:"text-foreground-lighter text-sm",children:"Metadata"}),(0,t.jsx)("pre",{className:" className={`text-foreground text-sm col-span-8 overflow-x-auto text-xs font-mono`}",dangerouslySetInnerHTML:{__html:(0,k.wv)(m.metadata)}})]})]})},G=()=>(0,t.jsx)("div",{className:"h-px w-full bg-panel-border-interior-light [[data-theme*=dark]_&]:bg-panel-border-interior-dark"}),U=e=>{var l,s,a,r,n,o,i,d,c,u,x,m,h;let{log:v}=e,j=null==v?void 0:null===(s=v.metadata[0])||void 0===s?void 0:null===(l=s.request)||void 0===l?void 0:l[0],g=null==v?void 0:null===(r=v.metadata[0])||void 0===r?void 0:null===(a=r.response)||void 0===a?void 0:a[0],f=null==j?void 0:j.method,p=null==g?void 0:g.status_code,w=null==j?void 0:null===(o=j.headers)||void 0===o?void 0:null===(n=o[0])||void 0===n?void 0:n.cf_connecting_ip,b=null==j?void 0:null===(d=j.headers)||void 0===d?void 0:null===(i=d[0])||void 0===i?void 0:i.cf_ipcountry,y=null==j?void 0:null===(u=j.headers)||void 0===u?void 0:null===(c=u[0])||void 0===c?void 0:c.x_client_info,N=null==j?void 0:null===(m=j.headers)||void 0===m?void 0:null===(x=m[0])||void 0===x?void 0:x.referer,_=null==v?void 0:null===(h=v.metadata[0])||void 0===h?void 0:h.load_balancer_redirect_identifier;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding," space-y-2"),children:[(0,t.jsx)(k.Yj,{label:"Status",value:p,valueRender:(0,t.jsx)(k.XA,{value:p})}),(0,t.jsx)(k.Yj,{label:"Method",value:f}),(0,t.jsx)(k.tS,{value:v.timestamp}),(0,t.jsx)(k.Yj,{label:"IP Address",value:w}),(0,t.jsx)(k.Yj,{label:"Origin Country",value:b}),y&&(0,t.jsx)(k.Yj,{label:"Client",value:y}),N&&(0,t.jsx)(k.Yj,{label:"Referer",value:N}),_&&(0,t.jsx)(k.Yj,{label:"Redirect Identifier",value:_})]}),(0,t.jsx)(G,{}),(0,t.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding),children:[(0,t.jsx)("h3",{className:"text-lg text-foreground mb-4",children:"Request Metadata"}),(0,t.jsx)("pre",{className:"text-sm syntax-highlight overflow-x-auto",children:(0,t.jsx)("div",{className:"text-wrap",dangerouslySetInnerHTML:{__html:j?(0,k.wv)(v.metadata[0].request[0]):""}})})]}),(0,t.jsx)(G,{}),(0,t.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding),children:[(0,t.jsx)("h3",{className:"text-lg text-foreground mb-4",children:"Response Metadata"}),(0,t.jsx)("pre",{className:"text-sm syntax-highlight overflow-x-auto",children:(0,t.jsx)("div",{dangerouslySetInnerHTML:{__html:g?(0,k.wv)(v.metadata[0].response[0]):""}})})]})]})},X=e=>{var l,s,a,r,n,o,i,d;let{log:c}=e,u=null==c?void 0:null===(s=c.metadata[0])||void 0===s?void 0:null===(l=s.parsed[0])||void 0===l?void 0:l.user_name,x=null==c?void 0:null===(r=c.metadata[0])||void 0===r?void 0:null===(a=r.parsed[0])||void 0===a?void 0:a.session_id,m=null==c?void 0:null===(o=c.metadata[0])||void 0===o?void 0:null===(n=o.parsed[0])||void 0===n?void 0:n.hint,h=null==c?void 0:null===(d=c.metadata[0])||void 0===d?void 0:null===(i=d.parsed[0])||void 0===i?void 0:i.error_severity;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:V.W.log_selection_x_padding,children:[(0,t.jsx)("span",{className:"col-span-4 text-sm text-foreground-lighter",children:"Event message"}),(0,t.jsx)("div",{className:"text-wrap mt-2 overflow-x-auto whitespace-pre-wrap font-mono  text-xs text-foreground",children:c.event_message})]}),(0,t.jsx)(G,{}),(0,t.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding," space-y-2"),children:[(0,t.jsx)(k.Yj,{label:"Severity",value:h,valueRender:(0,t.jsx)(k.TK,{value:h})}),(0,t.jsx)(k.tS,{value:c.timestamp}),(0,t.jsx)(k.Yj,{label:"Postgres Username",value:u}),(0,t.jsx)(k.Yj,{label:"Session ID",value:x})]}),m&&(0,t.jsx)("div",{className:"mt-4 ".concat(V.W.log_selection_x_padding),children:(0,t.jsx)(S.b,{variant:"warning",withIcon:!0,title:m})}),(0,t.jsx)(G,{}),(0,t.jsxs)("div",{className:V.W.log_selection_x_padding,children:[(0,t.jsx)("h3",{className:"mb-4 text-lg text-foreground",children:"Metadata"}),(0,t.jsx)("pre",{className:"syntax-highlight overflow-x-auto text-sm",children:(0,t.jsx)("div",{className:"text-wrap",dangerouslySetInnerHTML:{__html:c.metadata?(0,k.wv)(c.metadata[0]):""}})})]})]})},B=e=>{let{log:l}=e,s=e=>{let{label:l,value:s,code:a}=e;return(0,t.jsxs)("div",{className:"flex gap-2 flex-wrap",children:[(0,t.jsx)("span",{className:"text-foreground-lighter text-sm col-span-3",children:l}),(0,t.jsx)("span",{className:"text-foreground text-sm col-span-9 overflow-x-auto ".concat(a&&"text-xs font-mono"),children:(0,t.jsx)("pre",{dangerouslySetInnerHTML:{__html:(0,k.wv)(s)}})})]})};return(0,t.jsx)("div",{className:"overflow-hidden overflow-x-auto space-y-6",children:Object.entries(l).map((e,l)=>{let[a,r]=e;return(0,t.jsx)("div",{className:"px-4 pb-4",children:r&&"object"==typeof r?(0,t.jsx)(s,{label:a,value:r}):(0,t.jsx)(k.Yj,{label:a,value:null===r?"NULL ":String(r)})},"".concat(a,"-").concat(l))})})},Q=e=>{let{log:l}=e;return(0,t.jsxs)("div",{className:"space-y-6 py-4 px-5",children:[(null==l?void 0:l.timestamp)&&(0,t.jsx)(k.tS,{value:l.timestamp}),(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsx)("h3",{className:"text-foreground-lighter text-sm",children:"Event Message"}),(null==l?void 0:l.event_message)&&(0,t.jsx)(H.d,{className:"prose dark:prose-dark max-w-full",hideLineNumbers:!0,value:JSON.stringify(null==l?void 0:l.event_message)})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,t.jsx)("h3",{className:"text-foreground-lighter text-sm",children:"Metadata"}),(0,t.jsx)(H.d,{hideLineNumbers:!0,value:JSON.stringify(null==l?void 0:l.metadata,null,2)||"",language:"json",className:(0,g.cn)("max-w-full","!py-3 !px-3.5 prose dark:prose-dark transition","[&>code]:m-0 [&>code>span]:flex [&>code>span]:flex-wrap")})]})]})};function $(e){return Object.fromEntries(Object.entries(e).filter(e=>{let[l]=e;return!["host","url"].includes(l)}).map(e=>{let[l,s]=e;return"headers"===l?[l,s.map(e=>Object.fromEntries(Object.entries(e).filter(e=>{let[l]=e;return!l.startsWith("_")})))]:[l,s]}))}var ee=e=>{var l,s,a;let{log:r}=e,n=null===(l=r.metadata)||void 0===l?void 0:l[0],o=null==n?void 0:null===(s=n.request)||void 0===s?void 0:s[0],i=null==n?void 0:null===(a=n.response)||void 0===a?void 0:a[0],d=null==o?void 0:o.method,c=null==i?void 0:i.status_code,u=(null==o?void 0:o.url)!==void 0?new URL(null==o?void 0:o.url):void 0,x=n.execution_time_ms,m=n.deployment_id;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding," space-y-2"),children:[(0,t.jsx)(k.Yj,{label:"Status",value:c,valueRender:(0,t.jsx)(k.XA,{value:c})}),(0,t.jsx)(k.Yj,{label:"Method",value:d}),(0,t.jsx)(k.tS,{value:r.timestamp}),(0,t.jsx)(k.Yj,{label:"Execution Time",value:"".concat(x,"ms")}),(0,t.jsx)(k.Yj,{label:"Execution ID",value:n.execution_id}),(0,t.jsx)(k.Yj,{label:"Deployment ID",value:m}),(0,t.jsx)(k.Yj,{label:"Log ID",value:r.id}),void 0!==u&&(0,t.jsx)(k.Yj,{label:"Request Path",value:u.pathname+u.search})]}),(0,t.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding),children:[(0,t.jsx)("h3",{className:"text-lg text-foreground mb-4",children:"Request Metadata"}),(0,t.jsx)("pre",{className:"text-sm syntax-highlight overflow-x-auto",children:(0,t.jsx)("div",{className:"text-wrap",dangerouslySetInnerHTML:{__html:o?(0,k.wv)($(o)):""}})})]}),(0,t.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding),children:[(0,t.jsx)("h3",{className:"text-lg text-foreground mb-4",children:"Response Metadata"}),(0,t.jsx)("pre",{className:"text-sm syntax-highlight overflow-x-auto",children:(0,t.jsx)("div",{dangerouslySetInnerHTML:{__html:i?(0,k.wv)($(i)):""}})})]})]})},el=e=>{let{log:l}=e,s=l.metadata[0];return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding),children:[(0,t.jsx)("span",{className:"text-foreground-lighter text-sm col-span-4",children:"Event message"}),(0,t.jsx)("div",{className:"text-xs text-wrap font-mono text-foreground mt-2 whitespace-pre-wrap overflow-x-auto",children:l.event_message})]}),(0,t.jsx)("div",{className:"h-px w-full bg-panel-border-interior-light [[data-theme*=dark]_&]:bg-panel-border-interior-dark"}),(0,t.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding," space-y-2"),children:[(0,t.jsx)(k.Yj,{label:"Severity",value:s.level,valueRender:(0,t.jsx)(k.TK,{value:s.level})}),(0,t.jsx)(k.Yj,{label:"Deployment version",value:s.version}),(0,t.jsx)(k.tS,{value:l.timestamp}),(0,t.jsx)(k.Yj,{label:"Execution ID",value:s.execution_id}),(0,t.jsx)(k.Yj,{label:"Deployment ID",value:s.deployment_id})]}),(0,t.jsxs)("div",{className:"".concat(V.W.log_selection_x_padding),children:[(0,t.jsx)("h3",{className:"text-lg text-foreground mb-4",children:"Metadata"}),(0,t.jsx)("pre",{className:"text-sm syntax-highlight overflow-x-auto",children:(0,t.jsx)("div",{className:"text-wrap",dangerouslySetInnerHTML:{__html:s?(0,k.wv)(s):""}})})]})]})},es=e=>{let{projectRef:l,log:s,onClose:a,queryType:r,params:n={},collectionName:o}=e,{logData:i,isLoading:d}=J(l,r,n,null==s?void 0:s.id),[u,m]=(0,c.useState)(""),{refetch:h,data:v,isFetching:j}=(0,z._)({ref:l,sql:u},{enabled:"warehouse"===r,onError:e=>{x.ZP.error(e.message)}});return(0,c.useEffect)(()=>{m("select id, timestamp, event_message, metadata from `".concat(o,"`\n    where id = '").concat(null==s?void 0:s.id,"' and timestamp > '2024-01-01' limit 1"))},[o,null==s?void 0:s.id]),(0,c.useEffect)(()=>{"warehouse"===r&&h()},[v,o,l,null==s?void 0:s.id,h,r]),(0,c.useMemo)(()=>i&&r?"Log ID\n  ".concat(i.id,"\n\n  Log Timestamp (UTC)\n  ").concat((0,q.Sj)(i.timestamp)?(0,q.tI)(i.timestamp):i.timestamp,"\n\n  Log Event Message\n  ").concat(i.event_message,"\n\n  Log Metadata\n  ").concat(JSON.stringify(i.metadata,null,2),"\n  "):JSON.stringify(i||s,null,2),[i,s,r]),(0,t.jsxs)("div",{className:(0,g.cn)("relative flex h-full flex-grow flex-col border border-l border-overlay","overflow-y-scroll bg-studio"),children:[(0,t.jsx)("div",{className:(0,g.cn)("absolute flex h-full w-full flex-col items-center justify-center gap-2 overflow-y-scroll bg-studio text-center opacity-0 transition-all",{"z-0 opacity-0":s,"z-10 opacity-100":!s}),children:(0,t.jsxs)("div",{className:"flex\n          w-full\n          max-w-sm\n          scale-95\n          flex-col\n          items-center\n          justify-center\n          gap-6\n          text-center\n          opacity-0\n          transition-all delay-300 duration-500 "+(s||d?"mt-0 scale-95 opacity-0":"mt-8 scale-100 opacity-100"),children:[(0,t.jsxs)("div",{className:"relative flex h-4 w-32 items-center rounded border border-control px-2",children:[(0,t.jsx)("div",{className:"h-0.5 w-2/3 rounded-full bg-surface-300"}),(0,t.jsx)("div",{className:"absolute right-1 -bottom-4",children:(0,t.jsx)(F.Z,{size:"24",strokeWidth:1})})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("h3",{className:"text-sm text-foreground",children:"Select an Event"}),(0,t.jsx)("p",{className:"text-xs text-foreground-lighter",children:"warehouse"===r?"Select an Event to view the complete JSON payload":"Select an Event to view the code snippet (pretty view) or complete JSON payload (raw view)."})]})]})}),(0,t.jsx)("div",{className:"relative flex-grow flex flex-col bg-surface-100",children:(0,t.jsxs)(K.mQ,{defaultValue:"details",className:"flex flex-col",children:[(0,t.jsxs)(K.dr,{className:"px-2 pt-2",children:[(0,t.jsx)(K.SP,{className:"px-3",value:"details",children:"Details"}),(0,t.jsx)(K.SP,{className:"px-3",value:"raw",children:"Raw"}),(0,t.jsx)(p.z,{type:"text",className:"ml-auto absolute top-2 right-2 cursor-pointer transition hover:text-foreground h-6 w-6 px-0 py-0 flex items-center justify-center",onClick:a,children:(0,t.jsx)(M.Z,{size:14,strokeWidth:2,className:"text-foreground-lighter"})})]}),(0,t.jsx)("div",{className:"flex-grow",children:d||j?(0,t.jsx)("div",{className:"py-44",children:(0,t.jsx)(Y.Z,{})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(K.nU,{className:"bg-surface-100 space-y-6",value:"details",children:(0,t.jsx)(()=>{switch(r){case"warehouse":if(!v)return null;return(0,t.jsx)(Q,{log:v.result[0]});case"api":if(!i)return null;if(!i.metadata)return(0,t.jsx)(Q,{log:i});return(0,t.jsx)(U,{log:i});case"database":if(!i)return null;if(!i.metadata)return(0,t.jsx)(Q,{log:i});return(0,t.jsx)(X,{log:i});case"fn_edge":if(!i)return null;if(!i.metadata)return(0,t.jsx)(Q,{log:i});return(0,t.jsx)(ee,{log:i});case"functions":if(!i)return null;if(!i.metadata)return(0,t.jsx)(Q,{log:i});return(0,t.jsx)(el,{log:i});case"auth":if(!i)return null;if(!i.metadata)return(0,t.jsx)(Q,{log:i});return(0,t.jsx)(P,{log:i});default:if(r&&i&&(0,q.Oy)(i))return(0,t.jsx)(Q,{log:i});if(r&&!i||!s)return null;return(0,t.jsx)(B,{log:s})}},{})}),(0,t.jsx)(K.nU,{value:"raw",children:(0,t.jsx)(H.d,{hideLineNumbers:!0,language:"json",className:"prose w-full pt-0 max-w-full border-none",children:JSON.stringify(i||s,null,2)})})]})})]})})]})},et=s(750),ea=e=>{let{error:l}=e;return(0,t.jsx)(et.Z.TextArea,{size:"tiny",value:"string"==typeof l?l:JSON.stringify(l,null,2),borderless:!0,className:"mt-4 w-full font-mono",copy:!0,rows:7})},er=s(99176),en=s(46318);let eo=(0,c.createContext)({chevronAlign:"left",justified:!0,type:"default"});function ei(e){let{children:l,className:s,onChange:a,openBehaviour:r="multiple",type:n="default",defaultValue:o,justified:i=!1,chevronAlign:d="left"}=e,c=[(0,en.Z)("accordion").variants[n].base];return s&&c.push(s),(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(er.fC,{type:r,onValueChange:function(e){a&&a(e),e==typeof String&&e.split(" ")},defaultValue:o,className:c.join(" "),children:(0,t.jsx)(eo.Provider,{value:{chevronAlign:d,justified:i,type:n,defaultValue:o},children:(0,t.jsx)("div",{children:l})})})})}ei.Item=function(e){let{children:l,className:s,header:a,id:r,disabled:n}=e,o=(0,en.Z)("accordion"),[i,d]=(0,c.useState)(!1),{type:u,justified:x,chevronAlign:m}=(0,c.useContext)(eo),h=[o.variants[u].trigger];x&&h.push(o.justified),s&&h.push(s);let v=[o.chevron.base,o.chevron.align[m]];return i&&!n&&v.unshift("!rotate-180"),(0,t.jsxs)(er.ck,{value:r,className:o.variants[u].container,disabled:n,onClick:()=>{d(!i)},children:[(0,t.jsxs)(er.xz,{className:h.join(" "),children:[a,!n&&(0,t.jsx)(w.Z,{"aria-hidden":!0,className:v.join(" "),strokeWidth:2})]}),(0,t.jsx)(er.VY,{className:o.variants[u].content,children:(0,t.jsx)("div",{className:o.variants[u].panel,children:l})})]})};var ed=e=>{let{error:l,isCustomQuery:s}=e;return(0,t.jsxs)("div",{className:"flex flex-col gap-2 text-foreground-light",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1 text-sm",children:[(0,t.jsx)("p",{children:"This query requires too much memory to be executed."}),(0,t.jsx)("p",{children:s?"Avoid selecting entire objects and instead select specific keys using dot notation.":"Avoid querying across a large datetime range."}),!s&&(0,t.jsx)("p",{children:"Please contact support if this error persists."})]}),(0,t.jsx)(ei,{className:"text-sm",justified:!1,openBehaviour:"multiple",type:"default",chevronAlign:"left",size:"small",iconPosition:"left",children:(0,t.jsx)(ei.Item,{id:"1",header:"Full error message",children:(0,t.jsx)(et.Z.TextArea,{size:"tiny",value:JSON.stringify(l,null,2),borderless:!0,className:"mt-4 w-full font-mono",copy:!0,rows:5})})})]})},ec=e=>{let{data:l=[],queryType:s,onHistogramToggle:o,isHistogramShowing:k,isLoading:E,error:F,projectRef:M,params:Y,onRun:z,onSave:I,hasEditorValue:V,maxHeight:D,className:A,collectionName:J,emptyState:K,showHeader:H=!0,showHistogramToggle:P=!0}=e,[G,U]=(0,c.useState)(null),X=null==l?void 0:l[0],{profile:B}=(0,j.Un)(),Q=(0,h.Xo)(r.KA.CREATE,"user_content",{resource:{type:"log_sql",owner_id:null==B?void 0:B.id},subject:{id:null==B?void 0:B.id}}),$=Object.keys(function(){if(!X)return{};let{timestamp:e,...l}=X||{};return e?{timestamp:e,...l}:X}()||{}),ee=$.includes("id"),el=$.includes("timestamp"),et=$.map((e,l)=>({key:"logs-column-".concat(l),name:e,resizable:!0,renderCell:l=>{var s;let t=null===(s=l.row)||void 0===s?void 0:s[e];return t&&"object"==typeof t?JSON.stringify(t):null===t?"NULL":String(t)},renderHeaderCell:l=>(0,t.jsx)("div",{className:"flex items-center",children:e}),minWidth:128,maxWidth:"timestamp"===e?240:2400})),er=et;if(s)switch(s){case"warehouse":er=et;break;case"api":er=R;break;case"database":er=T;break;case"fn_edge":er=W;break;case"functions":er=O;break;case"auth":er=L;break;default:er=X&&(0,q.Oy)(X)?Z:et}let en=JSON.stringify(l),[eo,ei]=(0,c.useMemo)(()=>{let e=[...new Set(l)];if(!ee)return[e,{}];let s=e.reduce((e,l)=>(e[l.id]=l,e),{});return[e,s]},[l,ee]);(0,c.useEffect)(()=>{l&&(l.find(e=>i()(e,G))||U(null))},[l,G,en]);let ec=(0,c.useMemo)(()=>ee&&el?Object.values(ei).sort((e,l)=>l.timestamp-e.timestamp):eo,[eo,ee,el,ei]),eu=(0,c.useCallback)((e,l)=>(0,t.jsx)(u.X2,{...l,isRowSelected:!1,selectedCellIdx:void 0},e),[]),ex=()=>{(0,v.vQ)(en,()=>{x.ZP.success("Results copied to clipboard")})},em=(0,c.useRef)(null);function eh(){var e;null===(e=em.current)||void 0===e||e.click()}return l?(0,t.jsxs)("section",{className:"flex w-full flex-col h-full",style:{maxHeight:D},children:[!s&&(0,t.jsx)(()=>(0,t.jsxs)("div",{className:(0,g.cn)("flex w-full items-center justify-between border-t  bg-surface-100 px-5 py-2",A,{hidden:!H}),children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)(f.h_,{children:[(0,t.jsx)(f.$F,{asChild:!0,children:(0,t.jsxs)(p.z,{type:"text",iconRight:(0,t.jsx)(w.Z,{}),children:["Results ",l&&l.length?"(".concat(l.length,")"):""]})}),(0,t.jsxs)(f.AW,{align:"start",children:[(0,t.jsxs)(f.Xi,{onClick:eh,className:"space-x-2",children:[(0,t.jsx)(b.Z,{size:"tiny"}),(0,t.jsx)("div",{children:"Download CSV"})]}),(0,t.jsxs)(f.Xi,{onClick:ex,className:"space-x-2",children:[(0,t.jsx)(y.Z,{size:"tiny"}),(0,t.jsx)("div",{children:"Copy to clipboard"})]})]})]})}),(0,t.jsx)("div",{className:"hidden",children:(0,t.jsx)(m.Z,{buttonType:"text",data:l,children:(0,t.jsx)("div",{ref:em,children:"Download CSV"})})}),P&&(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsx)(p.z,{type:"default",icon:k?(0,t.jsx)(N.Z,{}):(0,t.jsx)(_.Z,{}),onClick:o,children:"Histogram"})}),(0,t.jsxs)("div",{className:"space-x-2",children:[n.Qy&&(0,t.jsxs)(a.fC,{delayDuration:0,children:[(0,t.jsx)(a.xz,{asChild:!0,children:(0,t.jsx)(p.z,{type:"default",onClick:I,disabled:!Q||!V,children:"Save query"})}),!Q&&(0,t.jsx)(a.h_,{children:(0,t.jsxs)(a.VY,{side:"bottom",children:[(0,t.jsx)(a.Eh,{className:"radix-tooltip-arrow"}),(0,t.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,t.jsx)("span",{className:"text-xs text-foreground",children:"You need additional permissions to save your query"})})]})})]}),(0,t.jsx)(p.z,{title:"run-logs-query",type:V?"primary":"alternative",disabled:!V,onClick:z,iconRight:(0,t.jsx)(d.Z,{size:12}),loading:E,children:"Run"})]})]}),{}),(0,t.jsx)("div",{className:"flex h-full flex-row overflow-x-auto",children:(0,t.jsxs)(C.pO,{direction:"horizontal",children:[(0,t.jsx)(C.ee,{defaultSize:G?60:100,children:(0,t.jsx)(u.ZP,{role:"table",style:{height:"100%"},className:(0,g.cn)("flex-1 flex-grow h-full",{"data-grid--simple-logs":s,"data-grid--logs-explorer":!s}),rowHeight:40,headerRowHeight:s?0:28,onSelectedCellChange:e=>{U(e.row)},selectedRows:new Set([]),columns:er,rowClass:e=>["font-mono tracking-tight",i()(e,G)?"!bg-surface-300 rdg-row--focused":" !bg-studio hover:!bg-surface-100 cursor-pointer"].join(" "),rows:ec,rowKeyGetter:e=>ee?e.id:JSON.stringify(e),renderers:{renderRow:eu,noRowsFallback:E?null:(0,t.jsxs)("div",{className:"mx-auto flex h-full w-full items-center justify-center space-y-12 py-4 transition-all delay-200 duration-500",children:[!F&&(K||(0,t.jsxs)("div",{className:"flex scale-100 flex-col items-center justify-center gap-6 text-center opacity-100",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,t.jsx)("div",{className:"relative flex h-4 w-32 items-center rounded border border-dashed border-stronger px-2"}),(0,t.jsx)("div",{className:"relative flex h-4 w-32 items-center rounded border border-dashed border-stronger px-2"})]}),(0,t.jsxs)("div",{className:"flex flex-col gap-1 px-5",children:[(0,t.jsx)("h3",{className:"text-lg text-foreground",children:"No results found"}),(0,t.jsx)("p",{className:"text-sm text-foreground-lighter",children:"Try another search or adjust the filters"})]})]})),F&&(()=>{var e;if(!F)return null;let l=ea;return"object"==typeof F&&(null===(e=F.error)||void 0===e?void 0:e.errors.find(e=>"resourcesExceeded"===e.reason))&&(l=ed),(0,t.jsx)("div",{className:"flex w-1/2 justify-center px-5",children:(0,t.jsx)(S.b,{variant:"danger",title:"Sorry! An error occurred when fetching data.",withIcon:!0,children:(0,t.jsx)(l,{isCustomQuery:!s,error:F})})})})()]})}})}),(0,t.jsx)(C.Dp,{}),G&&(0,t.jsx)(C.ee,{defaultSize:40,children:(0,t.jsx)(es,{projectRef:M,onClose:()=>U(null),log:G,queryType:s,params:Y,collectionName:J})})]})})]}):null}},10621:function(e,l,s){var t=s(52322),a=s(2784),r=s(83606),n=s(2322),o=s(32079),i=s(23418);l.Z=e=>{let{onClick:l,buttonType:s="default",icon:d,children:c,disabled:u,data:x,title:m}=e,h=(0,a.useRef)(null),v=()=>{var e;null===(e=h.current)||void 0===e||e.link.click()},j=(0,a.useMemo)(()=>{let e=null==x?void 0:x[0];if(!e||!x)return;let l=Object.keys(e);return x.map(e=>l.reduce((l,s)=>("object"==typeof e[s]?l[s]=JSON.stringify(e[s]):l[s]=String(e[s]),l),{}))},[JSON.stringify(x)]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.CSVLink,{ref:h,className:"hidden",data:j||[],filename:"supabase_logs.csv",title:m}),(0,t.jsxs)(n.u,{delayDuration:100,children:[(0,t.jsx)(n.aJ,{asChild:!0,children:(0,t.jsx)(o.z,{type:s,icon:d||(0,t.jsx)(i.Z,{}),disabled:u,className:"px-1.5",onClick:e=>{l&&l(e),v()},children:c})}),(0,t.jsx)(n._v,{side:"bottom",className:"text-xs",children:"Download logs as CSV"})]})]})}},51303:function(e,l,s){var t=s(52322);l.Z=e=>{let{children:l,active:s,className:a}=e;return(0,t.jsx)("div",{className:[a,"flex h-full flex-grow transition-opacity ",s?"opacity-30":"opacity-100"].join(" "),children:l})}},62112:function(e,l,s){s.d(l,{_:function(){return o}});var t=s(36492),a=s(31696),r=s(64883);async function n(e,l){let{ref:s,sql:t}=e;if(!t)throw Error("SQL must be provided");let{data:r,error:n}=await (0,a.U2)("/platform/projects/{ref}/analytics/warehouse/query",{params:{path:{ref:s},query:{bq_sql:t}},signal:l});return n&&(0,a.S3)(n),r}let o=function(e){let{ref:l,sql:s}=e,{enabled:a,...o}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,t.a)(r.d.warehouseQuery(l,s),e=>{let{signal:t}=e;return n({ref:l,sql:s},t)},{enabled:a,staleTime:1/0,cacheTime:9e5,refetchOnMount:!1,refetchInterval:!1,...o})}},58898:function(e,l,s){s.d(l,{d:function(){return S}});var t=s(52322),a=s(76141),r=s(94299),n=s(6659),o=s(2784),i=s(72282),d=s(90028),c=s(54383),u=s(32079);let x=e=>({hljs:{display:"block",overflowX:"auto",color:e?"#ddd":"#888"},"hljs-tag":{color:"#569cd6"},"hljs-keyword":{color:"#569cd6",fontWeight:"normal"},"hljs-selector-tag":{color:"#569cd6",fontWeight:"normal"},"hljs-literal":{color:"#569cd6",fontWeight:"normal"},"hljs-strong":{color:"#569cd6"},"hljs-name":{color:"#569cd6"},"hljs-code":{color:"#66d9ef"},"hljs-class .hljs-title":{color:"gray"},"hljs-attribute":{color:"#bf79db"},"hljs-symbol":{color:"#bf79db"},"hljs-regexp":{color:"#bf79db"},"hljs-link":{color:"#bf79db"},"hljs-string":{color:"#3ECF8E"},"hljs-bullet":{color:"#3ECF8E"},"hljs-subst":{color:"#3ECF8E"},"hljs-title":{color:"#3ECF8E",fontWeight:"normal"},"hljs-section":{color:"#3ECF8E",fontWeight:"normal"},"hljs-emphasis":{color:"#3ECF8E"},"hljs-type":{color:"#3ECF8E",fontWeight:"normal"},"hljs-built_in":{color:"#3ECF8E"},"hljs-builtin-name":{color:"#3ECF8E"},"hljs-selector-attr":{color:"#3ECF8E"},"hljs-selector-pseudo":{color:"#3ECF8E"},"hljs-addition":{color:"#3ECF8E"},"hljs-variable":{color:"#3ECF8E"},"hljs-template-tag":{color:"#3ECF8E"},"hljs-template-variable":{color:"#3ECF8E"},"hljs-comment":{color:e?"#999":"#888"},"hljs-quote":{color:"#75715e"},"hljs-deletion":{color:"#75715e"},"hljs-meta":{color:"#75715e"},"hljs-doctag":{fontWeight:"normal"},"hljs-selector-id":{fontWeight:"normal"}});var m=s(65820),h=s.n(m),v=s(27666),j=s(31806),g=s(88109),f=s(80039),p=s(86497),w=s(81303),b=s(83667),y=s(54299),N=s(14969),_=s(12463);let S=e=>{var l,s,m,S;let{title:C,language:k,linesToHighlight:E=[],highlightBorder:Z,styleConfig:L,className:R,value:T,theme:W,children:O,hideCopy:F=!1,hideLineNumbers:M=!1,renderer:Y}=e,{resolvedTheme:z}=(0,n.F)(),I=null==z?void 0:z.includes("dark"),V=null!=W?W:x(I),[q,D]=(0,o.useState)(!1),A=()=>{D(!0),setTimeout(()=>{D(!1)},1e3)},J=o.Children.toArray(O),[K]=1===J.length?J:[],H=null!==(s=null!=T?T:"string"==typeof K?K:void 0)&&void 0!==s?s:O,P="string"==typeof(H=null!==(m=null==H?void 0:null===(l=H.trimEnd)||void 0===l?void 0:l.call(H))&&void 0!==m?m:H)&&H.length<70?"short-inline-codeblock":"",G=k||(R?R.replace("language-",""):"js");"jsx"===G&&(G="js"),d.Z.registerLanguage("js",p.Z),d.Z.registerLanguage("ts",_.Z),d.Z.registerLanguage("py",y.Z),d.Z.registerLanguage("sql",N.Z),d.Z.registerLanguage("bash",v.Z),d.Z.registerLanguage("dart",g.Z),d.Z.registerLanguage("csharp",j.Z),d.Z.registerLanguage("json",w.Z),d.Z.registerLanguage("kotlin",b.Z),d.Z.registerLanguage("curl",h()),d.Z.registerLanguage("http",f.Z),("bash"===G||"sh"===G)&&(M=!0);let U=!M;return(0,t.jsxs)(t.Fragment,{children:[C&&(0,t.jsx)("div",{className:"text-sm rounded-t-md bg-surface-100 py-2 px-4 border border-b-0 border-default font-sans",children:C}),R?(0,t.jsxs)("div",{className:"group relative max-w-[90vw] md:max-w-none overflow-auto",children:[(0,t.jsx)(d.Z,{language:G,wrapLines:!0,style:V,className:(0,c.cn)("code-block border border-surface p-4 w-full !my-0 !bg-surface-100","".concat(C?"!rounded-t-none !rounded-b-md":"!rounded-md"),"".concat(U?"":"pl-6"),R),customStyle:{fontSize:13,lineHeight:1.4},showLineNumbers:U,lineProps:e=>E.includes(e)?{style:{display:"block",backgroundColor:(null==L?void 0:L.highlightBackgroundColor)?null==L?void 0:L.highlightBackgroundColor:"hsl(var(--background-selection))",borderLeft:Z?"1px solid ".concat((null==L?void 0:L.highlightBorderColor)?null==L?void 0:L.highlightBorderColor:"hsl(var(--foreground-default)",")"):null},class:"hljs-line-highlight"}:{},lineNumberContainerStyle:{paddingTop:"128px"},lineNumberStyle:{minWidth:"44px",paddingLeft:"4px",paddingRight:"4px",marginRight:"12px",color:null!==(S=null==L?void 0:L.lineNumber)&&void 0!==S?S:"#828282",textAlign:"center",fontSize:12,paddingTop:"4px",paddingBottom:"4px"},renderer:Y,children:H}),!F&&(T||O)&&R?(0,t.jsx)("div",{className:["absolute right-2 top-2","opacity-0 group-hover:opacity-100 transition","".concat(I?"dark":"")].join(" "),children:(0,t.jsx)(i,{text:T||O,children:(0,t.jsx)(u.z,{type:"default",className:"px-1.5",icon:q?(0,t.jsx)(a.Z,{}):(0,t.jsx)(r.Z,{}),onClick:()=>A(),children:q?"Copied":""})})}):null]}):(0,t.jsx)("code",{className:P,children:T||O})]})}},54506:function(e,l,s){var t=s(52322);s(2784);var a=s(13852),r=s(59073);l.Z=function(e){return(0,t.jsx)(r.Z,{icon:a.Z,...e})}}}]);