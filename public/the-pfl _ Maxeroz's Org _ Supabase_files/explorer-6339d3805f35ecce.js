(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6526],{50893:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/project/[ref]/logs/explorer",function(){return s(26470)}])},69076:function(e,t,s){"use strict";var n=s(52322),a=s(13252),l=s(28879),i=s.n(l),r=s(2784),o=s(34503),c=s(32079),d=s(59119),u=s(48869),m=s(62197);t.Z=e=>{let{to:t,from:s,onChange:l,helpers:h}=e,p=(0,m.PJ)(h),[x,f]=(0,r.useState)(t||s?"":p.text),j=h.find(e=>t===e.calcTo()&&s===e.calcFrom());return(0,r.useEffect)(()=>{j&&x!==j.text?f(j.text):!j&&(t||s)&&f("")},[j,t,s]),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsxs)(o.h_,{children:[(0,n.jsx)(o.$F,{asChild:!0,children:(0,n.jsx)(c.z,{type:x?"secondary":"default",icon:(0,n.jsx)(d.Z,{size:12}),className:"rounded-r-none",children:(0,n.jsx)("span",{children:(null==j?void 0:j.text)||p.text})})}),(0,n.jsx)(o.AW,{side:"bottom",align:"start",children:(0,n.jsx)(o._x,{onValueChange:e=>{let t=h.find(t=>t.text===e);l&&t&&l({to:t.calcTo(),from:t.calcFrom()})},value:(null==j?void 0:j.text)||"",children:h.map(e=>(0,n.jsx)(o.qB,{value:e.text,disabled:e.disabled,children:(0,n.jsx)("span",{className:[e.disabled?"text-foreground-light cursor-not-allowed":""].join(" "),children:e.text})},e.text))})})]}),(0,n.jsx)(a.M,{triggerButtonClassName:"rounded-l-none",triggerButtonType:j?"default":"secondary",triggerButtonTitle:"Custom",onChange:e=>{f(""),l&&l(e)},to:x?void 0:t,from:x?void 0:s,renderFooter:e=>{let{to:t,from:s}=e;if(t&&s&&Math.abs(i()(s).diff(i()(t),"day"))>m.$K)return(0,n.jsx)(u.b,{title:"",variant:"warning",className:"mx-3 pl-2 pr-2 pt-1 pb-2",children:"Large ranges may result in memory errors for big projects."})}})]})}},17635:function(e,t,s){"use strict";var n=s(52322),a=s(39097),l=s.n(a),i=s(89823),r=s(83690),o=s(32079),c=s(62197);t.Z=e=>{let{show:t,setShowUpgradePrompt:s}=e,a=(0,i.l)();return(0,n.jsxs)(r.Z,{hideFooter:!0,visible:t,closable:!0,size:"medium",header:"Log retention",onCancel:()=>s(!1),children:[(0,n.jsx)(r.Z.Content,{children:(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("p",{className:"text-sm",children:"Logs can be retained up to a duration of 3 months depending on the plan that your project is on."}),(0,n.jsxs)("div",{className:"border-control bg-surface-300 rounded border",children:[(0,n.jsxs)("div",{className:"flex items-center px-4 pt-2 pb-1",children:[(0,n.jsx)("p",{className:"text-foreground-light w-[40%] text-sm",children:"Plan"}),(0,n.jsx)("p",{className:"text-foreground-light w-[60%] text-sm",children:"Retention duration"})]}),(0,n.jsxs)("div",{className:"py-1",children:[(0,n.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,n.jsx)("p",{className:"w-[40%] text-sm",children:"Free"}),(0,n.jsx)("p",{className:"w-[60%] text-sm",children:c.fg.FREE.text})]}),(0,n.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,n.jsx)("p",{className:"w-[40%] text-sm",children:"Pro"}),(0,n.jsx)("p",{className:"w-[60%] text-sm",children:c.fg.PRO.text})]}),(0,n.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,n.jsx)("p",{className:"w-[40%] text-sm",children:"Team"}),(0,n.jsx)("p",{className:"w-[60%] text-sm",children:c.fg.TEAM.text})]}),(0,n.jsxs)("div",{className:"flex items-center px-4 py-1",children:[(0,n.jsx)("p",{className:"w-[40%] text-sm",children:"Enterprise"}),(0,n.jsx)("p",{className:"w-[60%] text-sm",children:c.fg.ENTERPRISE.text})]})]})]})]})}),(0,n.jsx)(r.Z.Separator,{}),(0,n.jsxs)(r.Z.Content,{className:"flex justify-end gap-3",children:[(0,n.jsx)(o.z,{type:"default",onClick:()=>s(!1),children:"Close"}),(0,n.jsx)(o.z,{asChild:!0,size:"tiny",children:(0,n.jsx)(l(),{href:"/org/".concat(null==a?void 0:a.slug,"/billing?panel=subscriptionPlan"),children:"Upgrade"})})]})]})}},82663:function(e,t,s){"use strict";var n=s(52322),a=s(79534),l=s(98537),i=s.n(l),r=s(34291),o=s.n(r),c=s(2784),d=s(80435),u=s(82955),m=s(54383),h=s(25733),p=s(98280);t.Z=e=>{let{id:t,language:s,defaultValue:l,autofocus:r=!0,isReadOnly:x=!1,hideLineNumbers:f=!1,onInputChange:j=o(),onInputRun:g=o(),className:v,loading:y,options:b,value:_,placeholder:N,disableTabToUsePlaceholder:w=!1}=e,C=(0,c.useRef)(),Z=(0,c.useRef)(),S=(0,c.useRef)(),E=void 0!==N&&0===(null!=_?_:"").trim().length,[k,q]=(0,c.useState)(E),T=async(e,t)=>{Z.current=e,S.current=t,(0,p.$)(e),C.current=e.createContextKey("hasValue",!1),C.current.set(void 0!==_&&_.trim().length>0),q(E),w||e.addCommand(t.KeyCode.Tab,()=>{e.executeEdits("source",[{identifier:"add-placeholder",range:new t.Range(1,1,1,1),text:(null!=N?N:"").split("\n\n").join("\n").replaceAll("*","").replaceAll("&nbsp;","")}])},"!hasValue"),e.addAction({id:"supabase",label:"Run Query",keybindings:[t.KeyMod.CtrlCmd+t.KeyCode.Enter],contextMenuGroupId:"operation",contextMenuOrder:0,run:async()=>{var e,t;g((null==Z?void 0:Z.current).getModel().getValueInRange(null==Z?void 0:null===(e=Z.current)||void 0===e?void 0:e.getSelection())||(null==Z?void 0:null===(t=Z.current)||void 0===t?void 0:t.getValue()))}});let s=e.getModel();if(s){let t=s.getPositionAt((null!=_?_:"").length);e.setPosition(t)}await (0,u.Vs)(500),r&&(null==e||e.focus())},P=i()({tabSize:2,fontSize:13,readOnly:x,minimap:{enabled:!1},wordWrap:"on",fixedOverflowWidgets:!0,contextmenu:!0,lineNumbers:f?"off":void 0,glyphMargin:!f&&void 0,lineNumbersMinChars:f?0:4,folding:!f&&void 0,scrollBeyondLastLine:!1},b);return(0,c.useEffect)(()=>{q(E)},[E]),(0,c.useEffect)(()=>{if(!w&&void 0!==Z.current&&void 0!==S.current){let e=Z.current,t=S.current;e.addCommand(t.KeyCode.Tab,()=>{e.executeEdits("source",[{identifier:"add-placeholder",range:new t.Range(1,1,1,1),text:(null!=N?N:"  ").split("\n\n").join("\n").replaceAll("*","").replaceAll("&nbsp;","")}])},"!hasValue")}},[N,w]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.default,{path:t,theme:"supabase",className:(0,m.cn)(v,"monaco-editor"),value:null!=_?_:void 0,language:s,defaultValue:null!=l?l:void 0,loading:y||(0,n.jsx)(h.Z,{}),options:P,onMount:T,onChange:e=>{C.current.set((null!=e?e:"").length>0),q(!e),j(e)}}),void 0!==N&&(0,n.jsx)("div",{className:(0,m.cn)("monaco-placeholder absolute top-[3px] left-[57px] text-sm pointer-events-none font-mono","[&>div>p]:text-foreground-lighter [&>div>p]:!m-0 tracking-tighter",k?"block":"hidden"),children:(0,n.jsx)(d.U,{content:N})})]})}},79044:function(e,t,s){"use strict";s.d(t,{T:function(){return c}});var n=s(85945),a=s(48228),l=s(62202),i=s(31696),r=s(65467);async function o(e,t){let{projectRef:s,payload:n}=e,{data:a,error:l}=await (0,i.v_)("/platform/projects/{ref}/content",{params:{path:{ref:s}},body:{id:n.id,name:n.name,description:n.description,owner_id:n.owner_id,type:n.type,visibility:n.visibility,content:n.content},signal:t});return l&&(0,i.S3)(l),a}let c=function(){let{onError:e,onSuccess:t,...s}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=(0,n.NL)();return(0,a.D)(e=>o(e),{async onSuccess(e,s,n){let{projectRef:a}=s;await i.invalidateQueries(r.$.list(a)),await (null==t?void 0:t(e,s,n))},async onError(t,s,n){void 0===e?l.ZP.error("Failed to insert content: ".concat(t.message)):e(t,s,n)},...s})}},18136:function(e,t,s){"use strict";var n=s(36492),a=s(2784),l=s(62197),i=s(88354),r=s(99248);t.Z=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=!(arguments.length>2)||void 0===arguments[2]||arguments[2],o=(0,l.PJ)(l.up),[c,d]=(0,a.useState)({sql:(null==t?void 0:t.sql)||"",project:e,iso_timestamp_start:t.iso_timestamp_start?t.iso_timestamp_start:o.calcFrom(),iso_timestamp_end:t.iso_timestamp_end?t.iso_timestamp_end:o.calcTo()}),u=s&&void 0!==e&&!!c.sql,m=(0,l.GT)(c),{data:h,error:p,isLoading:x,isRefetching:f,refetch:j}=(0,n.a)(["projects",e,"logs",m],t=>{let{signal:s}=t;return(0,i.U2)("".concat(r.T5,"/projects/").concat(e,"/analytics/endpoints/logs.all?").concat(m),{signal:s})},{enabled:u,refetchOnWindowFocus:!1}),g=p?p.message:null;return!g&&(null==h?void 0:h.error)&&(g=null==h?void 0:h.error),{params:c,isLoading:u&&x||f,logData:(0,i.d8)(h)&&h.result?h.result:[],error:g,changeQuery:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";d(t=>({...t,sql:e}))},runQuery:()=>j(),setParams:d}}},94422:function(e,t,s){"use strict";s.d(t,{_:function(){return r}});var n=s(16698),a=s(93463),l=s(2784),i=s(89823);let r=e=>{var t;let s=(0,i.l)(),{data:r}=(0,a.G)({orgSlug:null==s?void 0:s.slug}),[o,c]=(0,l.useState)(!1),d=(0,n.dP)(e,null==r?void 0:null===(t=r.plan)||void 0===t?void 0:t.id);return(0,l.useEffect)(()=>{d&&c(!0)},[e]),{showUpgradePrompt:o,setShowUpgradePrompt:c,shouldShowUpgradePrompt:d}}},26470:function(e,t,s){"use strict";s.r(t),s.d(t,{LogsExplorerPage:function(){return ea},default:function(){return el}});var n=s(52322),a=s(82719),l=s(28879),i=s.n(l),r=s(5632),o=s(2784),c=s(62202),d=s(79983),u=s(83690),m=s(62277),h=s(750),p=s(32079),x=s(99959),f=s(17635),j=s(51303),g=s(33706),v=s(79044),y=s(93463),b=s(18136),_=s(94422),N=s(99248),w=s(82955),C=s(75424),Z=s(39097),S=s.n(Z),E=s(24990),k=s(34503),q=s(81076),T=s(10012),P=s(48869),z=s(49251),R=s(53738),F=s(32830),A=s(9015),O=s(90488),L=s(54506),V=s(69076),$=s(15735),W=s(28702),I=s(78232),M=s(96958),D=s(62197),Q=s(40654),X=s(75939);function K(e){let{name:t,desc:s}=e;return(0,n.jsxs)("div",{className:"grid gap-1",children:[(0,n.jsx)("div",{className:"font-mono font-bold",children:t}),s&&(0,n.jsx)("div",{className:"text-foreground-light",children:s})]})}let U=e=>{let{field:t}=e,[s,a]=(0,o.useState)(!1);return(0,n.jsxs)($.Z.tr,{children:[(0,n.jsxs)($.Z.td,{className:"font-mono text-xs !p-2 cursor-pointer hover:text-foreground transition flex items-center space-x-2",onClick:()=>(0,w.vQ)(t.path,()=>{a(!0),setTimeout(()=>a(!1),3e3)}),children:[(0,n.jsx)("span",{children:t.path}),s?(0,n.jsxs)(E.fC,{delayDuration:0,children:[(0,n.jsx)(E.xz,{children:(0,n.jsx)(O.Z,{size:14,strokeWidth:3,className:"text-brand"})}),(0,n.jsx)(E.h_,{children:(0,n.jsxs)(E.VY,{side:"bottom",children:[(0,n.jsx)(E.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Copied"})})]})})]}):(0,n.jsxs)(E.fC,{delayDuration:0,children:[(0,n.jsx)(E.xz,{children:(0,n.jsx)(L.Z,{size:"tiny",strokeWidth:1.5})}),(0,n.jsx)(E.h_,{children:(0,n.jsxs)(E.VY,{side:"bottom",children:[(0,n.jsx)(E.Eh,{className:"radix-tooltip-arrow"}),(0,n.jsx)("div",{className:"rounded bg-alternative py-1 px-2 leading-none shadow border border-background",children:(0,n.jsx)("span",{className:"text-xs text-foreground",children:"Copy value"})})]})})]})]}),(0,n.jsx)($.Z.td,{className:"font-mono text-xs !p-2",children:t.type})]})};var G=e=>{let{templates:t=[],warehouseTemplates:s=[],onSelectTemplate:a,onSelectWarehouseTemplate:l,onSelectSource:i,defaultFrom:r,defaultTo:c,onDateChange:d,warnings:u,warehouseCollections:m,dataSource:h,onDataSourceChange:f}=e,[j,g]=(0,o.useState)(!1),{projectAuthAll:v,projectStorageAll:y,projectEdgeFunctionAll:b}=(0,Q.N)(["project_auth:all","project_storage:all","project_edge_function:all"]),_=(0,X.P)("warehouse"),N=Object.entries(D.U_).filter(e=>{let[t]=e;return"AUTH"===t?v:"STORAGE"===t?y:"FN_EDGE"===t?b:"WAREHOUSE"!==t}).map(e=>{let[,t]=e;return t});return(0,n.jsx)("div",{className:"border-b bg-surface-100",children:(0,n.jsx)("div",{className:"flex w-full items-center justify-between px-5 py-2",children:(0,n.jsxs)("div",{className:"flex w-full flex-row items-center justify-between gap-x-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[_&&(0,n.jsxs)(k.h_,{children:[(0,n.jsx)(k.$F,{asChild:!0,children:(0,n.jsxs)(p.z,{type:"default",iconRight:(0,n.jsx)(I.Z,{}),children:["Data source ",(0,n.jsx)("span",{className:"ml-2 font-mono opacity-50",children:h})]})}),(0,n.jsxs)(k.AW,{side:"bottom",align:"start",children:[(0,n.jsx)(k.Xi,{onClick:()=>f("logs"),children:(0,n.jsx)(K,{name:"Logs",desc:"Logs for all Supabase products"})}),(0,n.jsx)(k.Xi,{onClick:()=>f("warehouse"),children:(0,n.jsx)(K,{name:(0,n.jsxs)("span",{children:["Warehouse ",(0,n.jsx)(q.C,{variant:"warning",children:"NEW"})]}),desc:"Query your data warehouse collections"})})]})]}),"warehouse"===h&&(0,n.jsxs)(k.h_,{children:[(0,n.jsx)(k.$F,{asChild:!0,children:(0,n.jsx)(p.z,{type:"default",iconRight:(0,n.jsx)(I.Z,{}),children:"Templates"})}),(0,n.jsxs)(k.AW,{className:"max-h-96 overflow-auto",side:"bottom",align:"start",children:[s.map(e=>(0,n.jsx)(k.Xi,{onClick:()=>l(e),children:(0,n.jsx)(K,{name:e.name,desc:e.description})},e.name)),0===m.length&&(0,n.jsx)(k.Xi,{className:"hover:bg-transparent cursor-default",children:(0,n.jsx)(K,{name:"No collections found",desc:"You can create collections in the left sidebar."})})]})]}),"logs"===h&&(0,n.jsxs)(k.h_,{children:[(0,n.jsx)(k.$F,{asChild:!0,children:(0,n.jsx)(p.z,{type:"default",iconRight:(0,n.jsx)(I.Z,{}),children:"Insert source"})}),(0,n.jsx)(k.AW,{side:"bottom",align:"start",className:"max-h-[70vh] overflow-auto",children:"logs"===h&&N.sort((e,t)=>e.localeCompare(t)).map(e=>(0,n.jsx)(k.Xi,{onClick:()=>i(e),children:(0,n.jsx)(K,{name:e,desc:D.tZ[e]})},e))})]}),"logs"===h&&x.Qy&&(0,n.jsxs)(k.h_,{children:[(0,n.jsx)(k.$F,{asChild:!0,children:(0,n.jsx)(p.z,{type:"default",iconRight:(0,n.jsx)(I.Z,{}),children:"Templates"})}),(0,n.jsx)(k.AW,{side:"bottom",align:"start",children:t.sort((e,t)=>e.label.localeCompare(t.label)).map(e=>(0,n.jsx)(k.Xi,{onClick:()=>a(e),children:(0,n.jsx)("p",{children:e.label})},e.label))})]}),"logs"===h&&(0,n.jsx)(V.Z,{to:c,from:r,onChange:d,helpers:D.up}),(0,n.jsx)("div",{className:"overflow-hidden",children:(0,n.jsx)("div",{className:" transition-all duration-300 ".concat(u.length>0?"opacity-100":"invisible h-0 w-0 opacity-0"),children:(0,n.jsx)(T.Z,{overlay:(0,n.jsx)(P.b,{variant:"warning",title:"",children:(0,n.jsx)("div",{className:"flex flex-col gap-3",children:u.map((e,t)=>(0,n.jsxs)("p",{children:[e.text," ",e.link&&(0,n.jsx)(S(),{href:e.link,children:e.linkText||"View"})]},t))})}),children:(0,n.jsxs)(q.C,{variant:"warning",children:[u.length," ",u.length>1?"warnings":"warning"]})})})})]}),(0,n.jsx)("div",{children:(0,n.jsx)("div",{className:"flex items-center gap-4",children:(0,n.jsx)("div",{className:"flex items-center gap-2",children:(0,n.jsxs)(z.ZP,{size:"large",header:(0,n.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,n.jsx)("h3",{children:"Field Reference"}),(0,n.jsx)(p.z,{type:"text",className:"px-1",onClick:()=>g(!1),icon:(0,n.jsx)(R.Z,{size:18,strokeWidth:1.5})})]}),visible:j,cancelText:"Close",onCancel:()=>g(!1),hideFooter:!0,triggerElement:(0,n.jsx)(p.z,{asChild:!0,type:"default",onClick:()=>g(!0),icon:(0,n.jsx)(M.Z,{}),className:"px-2",children:(0,n.jsx)("span",{children:"Field Reference"})}),children:[(0,n.jsx)(z.ZP.Content,{children:(0,n.jsx)("div",{className:"pt-4 pb-2 space-y-1",children:(0,n.jsxs)("p",{className:"text-sm",children:["The following table shows all the available paths that can be queried from each respective source. Do note that to access nested keys, you would need to perform the necessary"," ",(0,n.jsxs)(S(),{href:"https://supabase.com/docs/guides/platform/logs#unnesting-arrays",target:"_blank",rel:"noreferrer",className:"text-brand",children:["unnesting joins",(0,n.jsx)(F.Z,{size:"tiny",className:"ml-1 inline -translate-y-[2px]",strokeWidth:1.5})]})]})})}),(0,n.jsx)(z.ZP.Separator,{}),(0,n.jsx)(A.Z,{scrollable:!0,size:"small",type:"underlined",defaultActiveId:"edge_logs",listClassNames:"px-2",children:W._S.schemas.map(e=>(0,n.jsx)(A.Z.Panel,{id:e.reference,label:e.name,className:"px-4 pb-4",children:(0,n.jsx)($.Z,{head:[(0,n.jsx)($.Z.th,{className:"text-xs !p-2",children:"Path"},"path"),(0,n.jsx)($.Z.th,{className:"text-xs !p-2",children:"Type"},"type")],body:e.fields.sort((e,t)=>e.path-t.path).map(e=>(0,n.jsx)(U,{field:e},e.path))})},e.reference))})]})})})})]})})})},B=s(16698),Y=s(89823),H=s(62112),J=s(53111),ee=s(82663),et=s(99009),es=s(55782);let en=x.Qy?"select\n  cast(timestamp as datetime) as timestamp,\n  event_message, metadata \nfrom edge_logs \nlimit 5":"select\n  timestamp, event_message, metadata\n  from edge_logs limit 5",ea=()=>{(0,B.Q9)();let e=(0,r.useRouter)(),{ref:t,q:s,ite:l,its:x}=(0,a.UO)(),Z=(0,Y.l)(),[S,E]=(0,o.useState)((0,w.k$)()),[k,q]=(0,o.useState)((0,w.k$)()),[T,P]=(0,o.useState)(en),[z,R]=(0,o.useState)("-- Fetch the last 10 logs in the last 7 days \nselect id, timestamp, event_message from `COLLECTION_NAME` \nwhere timestamp > timestamp_sub(current_timestamp(), interval 7 day) \norder by timestamp desc limit 10"),[F,A]=(0,o.useState)(!1),[O,L]=(0,o.useState)([]),V=e.query.source,[$,W]=(0,o.useState)(V||"logs"),{data:I}=(0,y.G)({orgSlug:null==Z?void 0:Z.slug}),{params:M,logData:Q,error:X,isLoading:K,changeQuery:U,runQuery:es,setParams:ea}=(0,b.Z)(t,{iso_timestamp_start:x||void 0,iso_timestamp_end:l||void 0},"logs"===$),{refetch:el,data:ei,isFetching:er,error:eo}=(0,H._)({ref:t,sql:z},{enabled:!1});(0,o.useEffect)(()=>{eo&&c.ZP.error(eo.message)},[eo]);let ec=K||er,[ed,eu]=(0,J._)("project-content-".concat(t,"-recent-log-sql"),[]),{data:em}=(0,C.O)({projectRef:t}),eh=e=>{eu([...ed,{schema_version:"1",favorite:!1,sql:"",content_id:"",...e}])},{showUpgradePrompt:ep,setShowUpgradePrompt:ex}=(0,_._)(M.iso_timestamp_start);(0,o.useEffect)(()=>{s&&ef({mode:"custom",searchString:s})},[]),(0,o.useEffect)(()=>{let e=[],t=M.iso_timestamp_start?i()(M.iso_timestamp_start):i()(),s=M.iso_timestamp_end?i()(M.iso_timestamp_end):i()(),n=Math.abs(t.diff(s,"days"));T&&!T.includes("limit")&&n>D.$K&&e.push({text:"When querying large date ranges, include a LIMIT clause."}),L(e)},[T,M.iso_timestamp_start,M.iso_timestamp_end]),(0,o.useEffect)(()=>{if(x){var e;(0,B.dP)(x,null==I?void 0:null===(e=I.plan)||void 0===e?void 0:e.id)&&ex(!ep)}},[x,I]);let ef=t=>{P(t.searchString),U(t.searchString),E((0,w.k$)()),e.push({pathname:e.pathname,query:{...e.query,q:t.searchString}}),eh({sql:t.searchString})},ej=t=>{let s="string"==typeof t&&t||T;if(t&&"string"==typeof t&&P(t),"warehouse"===$){if(!(null==em?void 0:em.length)){c.ZP.error("You do not have any collections in your warehouse yet.");return}let t=null==em?void 0:em.map(e=>e.name);if(!(null==t?void 0:t.find(e=>z.includes(e)))){c.ZP.error("Please specify a collection name in the query");return}if(Object.values(D.ae).find(e=>z.includes(e))){c.ZP.error("Cannot query logs tables from a warehouse query. Please remove the logs table from the query.");return}el(),e.push({pathname:e.pathname,query:{...e.query,q:s}});return}U(s),es(),e.push({pathname:e.pathname,query:{...e.query,q:s}}),eh({sql:s})};function eg(){A(!F)}let{isLoading:ev,mutate:ey}=(0,v.T)({onError:e=>{console.error(e),A(!1),c.ZP.error("Failed to save query: ".concat(e.message))},onSuccess:e=>{A(!1),c.ZP.success('Saved "'.concat(e[0].name,'" log query'))}});return(0,n.jsxs)("div",{className:"w-full h-full mx-auto",children:[(0,n.jsxs)(d.pO,{className:"w-full h-full",direction:"vertical",autoSaveId:N.dA.LOG_EXPLORER_SPLIT_SIZE,children:[(0,n.jsxs)(d.ee,{collapsible:!0,minSize:5,children:[(0,n.jsx)(G,{defaultFrom:M.iso_timestamp_start||"",defaultTo:M.iso_timestamp_end||"",onDateChange:t=>{var s;let{to:n,from:a}=t;(0,B.dP)(a,null==I?void 0:null===(s=I.plan)||void 0===s?void 0:s.id)?ex(!ep):(ea(e=>({...e,iso_timestamp_start:a||"",iso_timestamp_end:n||""})),e.push({pathname:e.pathname,query:{...e.query,its:a||"",ite:n||""}}))},onSelectSource:e=>{if("warehouse"===$){q((0,w.k$)());return}P(t=>{let s=t.indexOf("from");return -1===s?"".concat(t).concat(e):"".concat(t.substring(0,s+4)," ").concat(e," ").concat(t.substring(s+5))}),E((0,w.k$)())},onClear:()=>{P(""),E((0,w.k$)()),q((0,w.k$)()),U("")},hasEditorValue:!!T,templates:D.xN.filter(e=>"custom"===e.mode),warehouseCollections:em||[],onSelectTemplate:ef,warehouseTemplates:(em||[]).map(e=>({query:"select id, timestamp, event_message from `"+e.name+"`\nwhere timestamp > timestamp_sub(current_timestamp(), interval 7 day)\norder by timestamp desc limit 10",name:"".concat(e.name),description:"Select last 10 events from ".concat(e.name," collection")})),onSelectWarehouseTemplate:e=>{R(e.query),q((0,w.k$)())},onSave:eg,isLoading:ec,warnings:O,dataSource:$,onDataSourceChange:t=>{W(t),e.push({pathname:e.pathname,query:{...e.query,source:t}})}}),(0,n.jsx)(g.Z,{active:ec}),"warehouse"===$?(0,n.jsx)(ee.Z,{id:k,language:"pgsql",defaultValue:z,onInputChange:e=>R(e||""),onInputRun:ej}):(0,n.jsx)(ee.Z,{id:S,language:"pgsql",defaultValue:T,onInputChange:e=>P(e||""),onInputRun:ej})]}),(0,n.jsx)(d.Dp,{withHandle:!0}),(0,n.jsxs)(d.ee,{collapsible:!0,minSize:5,className:"flex flex-col flex-grow",children:[(0,n.jsx)(j.Z,{active:ec,children:(0,n.jsx)(et.Z,{showHistogramToggle:!1,onRun:ej,onSave:eg,hasEditorValue:!!T,params:M,data:"warehouse"===$?null==ei?void 0:ei.result:Q,error:X,projectRef:t})}),(0,n.jsx)("div",{className:"flex flex-row justify-end mt-2",children:(0,n.jsx)(f.Z,{show:ep,setShowUpgradePrompt:ex})})]})]}),(0,n.jsx)(u.Z,{size:"medium",onCancel:()=>A(!F),header:"Save log query",visible:F,hideFooter:!0,children:(0,n.jsx)(m.Z,{initialValues:{name:"",desdcription:""},onSubmit:async(e,s)=>{let{setSubmitting:n}=s;n(!0),ey({projectRef:t,payload:{id:(0,w.k$)(),name:e.name,description:e.description||"",type:"log_sql",content:{content_id:S,sql:T,schema_version:"1",favorite:!1},visibility:"user"}})},children:()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(u.Z.Content,{className:"space-y-6",children:[(0,n.jsx)(h.Z,{layout:"horizontal",label:"Name",id:"name"}),(0,n.jsx)("div",{className:"text-area-text-sm",children:(0,n.jsx)(h.Z.TextArea,{layout:"horizontal",labelOptional:"Optional",label:"Description",id:"description",rows:2})})]}),(0,n.jsx)(u.Z.Separator,{}),(0,n.jsxs)(u.Z.Content,{className:"flex items-center justify-end gap-2",children:[(0,n.jsx)(p.z,{size:"tiny",type:"default",onClick:()=>A(!F),children:"Cancel"}),(0,n.jsx)(p.z,{size:"tiny",loading:ev,disabled:ev,htmlType:"submit",children:"Save"})]})]})})})]})};ea.getLayout=e=>(0,n.jsx)(es.Z,{children:e});var el=ea},9015:function(e,t,s){"use strict";var n=s(52322),a=s(64266),l=s(2784),i=s(46318);let r=e=>{var t,s,r;let{defaultActiveId:o,activeId:c,type:d="pills",size:u="tiny",block:m,onChange:h,onClick:p,scrollable:x,wrappable:f,addOnBefore:j,addOnAfter:g,listClassNames:v,baseClassNames:y,refs:b,children:_}=e,N=l.Children.toArray(_),[w,C]=(0,l.useState)(null!==(r=null!=c?c:o)&&void 0!==r?r:null==N?void 0:null===(s=N[0])||void 0===s?void 0:null===(t=s.props)||void 0===t?void 0:t.id);(0,l.useMemo)(()=>{c&&c!==w&&C(c)},[c]);let Z=(0,i.Z)("tabs");function S(e){null==p||p(e),e!==w&&(null==h||h(e),C(e))}let E=[Z[d].list];return x&&E.push(Z.scrollable),f&&E.push(Z.wrappable),v&&E.push(v),(0,n.jsxs)(a.fC,{value:w,className:[Z.base,y].join(" "),ref:null==b?void 0:b.base,children:[(0,n.jsxs)(a.aV,{className:E.join(" "),ref:null==b?void 0:b.list,children:[j,N.map(e=>{let t=w===e.props.id,s=[Z[d].base,Z.size[u]];return t?s.push(Z[d].active):s.push(Z[d].inactive),m&&s.push(Z.block),(0,n.jsxs)(a.xz,{onKeyDown:t=>{"Enter"===t.key&&(t.preventDefault(),S(e.props.id))},onClick:()=>S(e.props.id),value:e.props.id,className:s.join(" "),children:[e.props.icon,(0,n.jsx)("span",{children:e.props.label}),e.props.iconRight]},"".concat(e.props.id,"-tab-button"))}),g]}),N]})};r.Panel=e=>{let{children:t,id:s,className:l}=e,r=(0,i.Z)("tabs");return(0,n.jsx)(a.VY,{value:s,className:[r.content,l].join(" "),children:t})},t.Z=r}},function(e){e.O(0,[8421,538,8183,7385,6770,3844,63,8993,8395,3736,7148,9420,7833,7370,9176,3111,6124,4830,9428,6640,5022,2488,1023,5782,8441,2888,9774,179],function(){return e(e.s=50893)}),_N_E=e.O()}]);